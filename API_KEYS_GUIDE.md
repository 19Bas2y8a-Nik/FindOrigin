# Руководство по получению API ключей

## AI: OpenRouter (openai/gpt-4o-mini)

Бот использует OpenRouter с моделью **openai/gpt-4o-mini** для:
- формирования поискового запроса по тексту пользователя;
- ранжирования найденных источников по релевантности.

**Как получить:**

1. Зарегистрируйтесь на [OpenRouter](https://openrouter.ai/)
2. Перейдите в [Keys](https://openrouter.ai/settings/keys)
3. Создайте API ключ и скопируйте его

**Настройка в .env.local:**
```env
OPENROUTER_API_KEY=sk-or-v1-...
```

Без ключа поисковый запрос берётся из текста как есть, ранжирование — по типу источника (официальные, новостные и т.д.).

---

## Поисковые API

Проект поддерживает три поисковых API. Выберите один из вариантов:

## 1. Google Custom Search API (Рекомендуется)

**Преимущества:**
- Бесплатный лимит: 100 запросов в день
- Хорошее качество результатов
- Официальный API от Google

**Как получить:**

1. Перейдите на [Google Cloud Console](https://console.cloud.google.com/)
2. Создайте новый проект или выберите существующий
3. Включите **Custom Search API**:
   - Перейдите в "APIs & Services" → "Library"
   - Найдите "Custom Search API"
   - Нажмите "Enable"
4. Создайте API ключ:
   - Перейдите в "APIs & Services" → "Credentials"
   - Нажмите "Create Credentials" → "API Key"
   - Скопируйте созданный ключ
5. Создайте поисковую систему (Custom Search Engine):
   - Перейдите на [Google Custom Search](https://programmablesearchengine.google.com/controlpanel/create)
   - Нажмите "Add" для создания новой поисковой системы
   - В поле "Sites to search" введите `*` (звездочка) для поиска по всему интернету
   - Нажмите "Create"
   - После создания перейдите в "Setup" → "Basics"
   - Скопируйте **Search engine ID** (CX)

**Настройка в .env.local:**
```env
SEARCH_API_KEY=ваш_google_api_key
SEARCH_ENGINE=google
GOOGLE_SEARCH_ENGINE_ID=ваш_search_engine_id
```

**Ограничения:**
- 100 бесплатных запросов в день
- После превышения лимита нужна оплата

---

## 2. SerpAPI

**Преимущества:**
- 100 бесплатных запросов в месяц
- Не требует создания поисковой системы
- Простая настройка

**Как получить:**

1. Зарегистрируйтесь на [SerpAPI](https://serpapi.com/)
2. Перейдите в [Dashboard](https://serpapi.com/dashboard)
3. Скопируйте ваш **API Key** из раздела "Your API Key"

**Настройка в .env.local:**
```env
SEARCH_API_KEY=ваш_serpapi_key
SEARCH_ENGINE=serpapi
```

**Ограничения:**
- 100 бесплатных запросов в месяц
- После превышения лимита нужна подписка ($50/месяц за 5000 запросов)

---

## 3. Bing Search API (Microsoft Azure)

**Преимущества:**
- 1000 бесплатных запросов в месяц
- Хороший лимит для начала

**Как получить:**

1. Зарегистрируйтесь на [Azure Portal](https://portal.azure.com/)
2. Создайте новый ресурс:
   - Нажмите "Create a resource"
   - Найдите "Bing Search v7"
   - Нажмите "Create"
3. Заполните форму:
   - Выберите подписку (можно создать бесплатную)
   - Создайте новую Resource Group или выберите существующую
   - Выберите Pricing tier (Free tier доступен)
   - Нажмите "Review + create" → "Create"
4. Получите API ключ:
   - После создания ресурса перейдите в него
   - В разделе "Keys and Endpoint" скопируйте **Key 1**

**Настройка в .env.local:**
```env
SEARCH_API_KEY=ваш_bing_api_key
SEARCH_ENGINE=bing
```

**Ограничения:**
- 1000 бесплатных запросов в месяц
- После превышения лимита нужна оплата

---

## Рекомендации по выбору

### Для разработки и тестирования:
- **SerpAPI** - самый простой в настройке, 100 запросов/месяц бесплатно

### Для продакшена с небольшим трафиком:
- **Bing Search API** - 1000 запросов/месяц бесплатно, хороший выбор

### Для продакшена с большим трафиком:
- **Google Custom Search API** - надежный, но требует оплаты после 100 запросов/день

---

## Проверка работы API

После настройки ключей, проверьте работу:

1. Запустите проект: `npm run dev`
2. Отправьте боту тестовое сообщение
3. Проверьте логи в консоли на наличие ошибок

Если видите ошибки типа "API key invalid" или "Quota exceeded", проверьте:
- Правильность ключа в `.env.local`
- Не превышен ли лимит запросов
- Правильно ли указан `SEARCH_ENGINE`

---

## Безопасность

⚠️ **Важно:** Никогда не коммитьте файл `.env.local` в git!

Убедитесь, что `.env.local` находится в `.gitignore` (он уже там по умолчанию).

Для продакшена на Vercel:
1. Перейдите в настройки проекта на Vercel
2. Добавьте переменные окружения в разделе "Environment Variables"
3. Они будут автоматически доступны в runtime
